--1
SELECT TEAM_NAME "전체 축구팀 목록"
FROM TEAM
ORDER BY 1
;
--2
SELECT DISTINCT POSITION 포지션
FROM PLAYER
ORDER BY 1
;
--3
SELECT DISTINCT NVL2(POSITION,POSITION,'신입') 포지션
FROM PLAYER
;
--4
SELECT PLAYER_NAME 이름
FROM PLAYER
WHERE TEAM_ID LIKE 'K02'
    AND POSITION LIKE 'GK'
;
--5.
SELECT POSITION 포지션, PLAYER_NAME 이름
FROM PLAYER
WHERE TEAM_ID LIKE 'K02' 
    AND POSITION LIKE 'MF'
    AND PLAYER_NAME LIKE '고%'
    AND HEIGHT >= 170
;
--6.
SELECT PLAYER_NAME||'선수' 이름,
    CASE WHEN HEIGHT IS NOT NULL
    THEN HEIGHT||'cm'
    ELSE TO_CHAR('0cm')
    END 키,
    CASE WHEN WEIGHT IS NOT NULL
    THEN WEIGHT||'kg'
    ELSE TO_CHAR('0kg')
    END 몸무게
FROM PLAYER
WHERE TEAM_ID LIKE 'K02'
ORDER BY HEIGHT DESC
;
--7.
SELECT PLAYER_NAME 이름, CASE WHEN HEIGHT IS NOT NULL
    THEN HEIGHT||'cm'
    ELSE TO_CHAR('0cm')
    END 키,
    CASE WHEN WEIGHT IS NOT NULL
    THEN WEIGHT||'kg'
    ELSE TO_CHAR('0kg')
    END 몸무게, ROUND(WEIGHT/((HEIGHT/100)*(HEIGHT/100)),2) BMI비만지수
FROM PLAYER
WHERE TEAM_ID LIKE 'K02'
ORDER BY HEIGHT DESC
;
--8.
SELECT T.TEAM_NAME, P.POSITION, P.PLAYER_NAME
FROM PLAYER P JOIN TEAM T
    ON P.TEAM_ID LIKE T.TEAM_ID
WHERE T.TEAM_ID IN('K02', 'K10')
    AND P.POSITION LIKE 'GK'
ORDER BY 1,3
;
--9.
SELECT P.HEIGHT||'cm' 키, T.TEAM_NAME, P.PLAYER_NAME
FROM PLAYER P JOIN TEAM T
    ON P.TEAM_ID LIKE T.TEAM_ID
WHERE T.TEAM_ID IN('K02', 'K10')
    AND HEIGHT BETWEEN 180 AND 183
ORDER BY 1,2,3
;
--10.
SELECT TEAM_NAME 팀명, PLAYER_NAME 이름
FROM PLAYER P JOIN TEAM T
    ON P.TEAM_ID LIKE T.TEAM_ID
WHERE POSITION IS NULL
ORDER BY 1,2
;

--11.
SELECT T.TEAM_NAME 팀명, S.STADIUM_NAME 스타디움
FROM TEAM T JOIN STADIUM S
    ON T.STADIUM_ID LIKE S.STADIUM_ID
ORDER BY 1
;
--12.
SELECT T.TEAM_NAME 팀명, S.STADIUM_NAME 스타디움, C.AWAYTEAM_ID 원정팀ID, C.SCHE_DATE 스케줄날짜
FROM TEAM T JOIN STADIUM S
    ON T.STADIUM_ID LIKE S.STADIUM_ID
    JOIN SCHEDULE C
    ON S.STADIUM_ID LIKE C.STADIUM_ID
WHERE SCHE_DATE LIKE '20120317'
ORDER BY 1
;
--13.
SELECT P.PLAYER_NAME 선수명, P.POSITION 포지션, CONCAT(T.REGION_NAME || ' ', T.TEAM_NAME) 팀명,
S.STADIUM_NAME 스타디움, C.SCHE_DATE 스케줄날짜
FROM PLAYER P JOIN TEAM T
    ON P.TEAM_ID LIKE T.TEAM_ID
    JOIN STADIUM S
    ON T.STADIUM_ID LIKE S.STADIUM_ID
    JOIN SCHEDULE C
    ON S.STADIUM_ID LIKE C.STADIUM_ID
WHERE SCHE_DATE LIKE '20120317'
AND T.TEAM_NAME LIKE '스틸러스'
AND P.POSITION LIKE 'GK'
ORDER BY 1
;
--14.
SELECT A.STADIUM_NAME 스타디움, A.SCHE_DATE 경기날짜,(SELECT CONCAT(T.REGION_NAME || ' ', T.TEAM_NAME)
    FROM TEAM T WHERE A.HOMETEAM_ID LIKE T.TEAM_ID
    ) 홈팀,
    (SELECT CONCAT(T.REGION_NAME || ' ', T.TEAM_NAME)
    FROM TEAM T WHERE A.AWAYTEAM_ID LIKE T.TEAM_ID
    ) 원정팀, A.HOME_SCORE "홈팀 점수", A.AWAY_SCORE "원정팀 점수"
FROM (SELECT S.STADIUM_NAME, T.TEAM_ID, T.TEAM_NAME, T.REGION_NAME, C.HOME_SCORE, C.AWAY_SCORE, C.SCHE_DATE, C.HOMETEAM_ID, C.AWAYTEAM_ID
    FROM TEAM T JOIN STADIUM S
    ON T.STADIUM_ID LIKE S.STADIUM_ID
    JOIN SCHEDULE C
    ON S.STADIUM_ID LIKE C.STADIUM_ID
WHERE C.HOME_SCORE - C.AWAY_SCORE >= 3
) A
ORDER BY 2
;
SELECT *
FROM SCHEDULE
;
--15.
SELECT S.STADIUM_NAME, S.STADIUM_ID, S.SEAT_COUNT, S.HOMETEAM_ID, T.E_TEAM_NAME
FROM STADIUM S LEFT JOIN TEAM T
    ON S.STADIUM_ID LIKE T.STADIUM_ID
WHERE ROWNUM <= 20
ORDER BY HOMETEAM_ID
;
--16.
SELECT P.TEAM_ID 팀아이디, T.TEAM_NAME 팀명, ROUND(AVG(P.HEIGHT),2) 평균키
FROM PLAYER P JOIN TEAM T
    ON P.TEAM_ID LIKE T.TEAM_ID
GROUP BY P.TEAM_ID, T.TEAM_NAME
HAVING AVG(P.HEIGHT) < (SELECT AVG(P.HEIGHT)
    FROM PLAYER P JOIN TEAM T
        ON P.TEAM_ID LIKE T.TEAM_ID
    WHERE T.TEAM_NAME LIKE '유나이티드')
    ORDER BY 3
;

--17.
SELECT T.TEAM_NAME 팀명, P.PLAYER_NAME 선수명, P.BACK_NO 백넘버
FROM PLAYER P JOIN TEAM T
    ON P.TEAM_ID LIKE T.TEAM_ID
WHERE POSITION LIKE 'MF'
ORDER BY 2
;
--18.
SELECT PLAYER_NAME 선수명, BACK_NO 백넘버, POSITION 포지션, HEIGHT 키
FROM (SELECT PLAYER_NAME, BACK_NO, POSITION, HEIGHT
    FROM PLAYER
    WHERE HEIGHT IS NOT NULL
    ORDER BY HEIGHT DESC)
WHERE ROWNUM < 6
ORDER BY 4 DESC,1
;
--19.
SELECT T.TEAM_NAME 팀명, P.PLAYER_NAME 선수명, P.POSITION 포지션, P.BACK_NO 백넘버, P.HEIGHT 키
FROM PLAYER P JOIN TEAM T
    ON P.TEAM_ID LIKE T.TEAM_ID
WHERE P.HEIGHT < (SELECT AVG(S.HEIGHT)
    FROM PLAYER S
    WHERE S.TEAM_ID LIKE P.TEAM_ID
    GROUP BY P.TEAM_ID
    )
ORDER BY 2
;
--20.
SELECT STADIUM_ID ID, STADIUM_NAME 경기장명
FROM (SELECT STADIUM_ID, STADIUM_NAME
    FROM STADIUM
    WHERE EXISTS
    (SELECT S.STADIUM_ID, S.STADIUM_NAME
    FROM STADIUM S JOIN SCHEDULE C
        ON S.STADIUM_ID LIKE C.STADIUM_ID
    WHERE C.SCHE_DATE LIKE '201205%'
    ))
ORDER  BY 1
;
--21.
SELECT PLAYER_NAME 선수명, POSITION 포지션, BACK_NO 백넘버
FROM (SELECT PLAYER_NAME, POSITION, BACK_NO
    FROM PLAYER
    WHERE TEAM_ID LIKE (SELECT TEAM_ID
        FROM PLAYER
        WHERE PLAYER_NAME LIKE '이현'
        )
    )
ORDER BY 1
;
--22.
SELECT TEAM_ID, NVL(SUM(CASE POSITION WHEN 'FW' THEN 1 ELSE 0 END),0) FW
, NVL(SUM(CASE POSITION WHEN 'MF' THEN 1 ELSE 0 END),0) MF
, NVL(SUM(CASE POSITION WHEN 'DF' THEN 1 ELSE 0 END),0) DF
, NVL(SUM(CASE POSITION WHEN 'GK' THEN 1 ELSE 0 END),0) GK
, COUNT(*) SUM
FROM PLAYER
GROUP BY TEAM_ID
ORDER BY 1
;
--23.
SELECT ROUND(AVG(CASE WHEN POSITION LIKE 'MF' THEN HEIGHT END),2) 미드필더,
   ROUND(AVG(CASE WHEN POSITION LIKE 'FW' THEN HEIGHT END),2) 포워드,
   ROUND(AVG(CASE WHEN POSITION LIKE 'DF' THEN HEIGHT END),2) 디펜더,
   ROUND(AVG(CASE WHEN POSITION LIKE 'GK' THEN HEIGHT END),2) 골키퍼,
   ROUND(AVG(HEIGHT),2) 전체평균키
FROM PLAYER
;
--24.
SELECT P.TEAM_ID 팀아이디, T.TEAM_NAME 팀명, P.PLAYER_NAME 선수, P.POSITION 포지션, P.BACK_NO 백넘버, P.HEIGHT 키
FROM PLAYER P JOIN TEAM T
    ON P.TEAM_ID LIKE T.TEAM_ID
WHERE (P.TEAM_ID, P.HEIGHT)  IN(SELECT X.TEAM_ID, MIN(X.HEIGHT)
    FROM PLAYER X
    WHERE X.TEAM_ID LIKE P.TEAM_ID
    GROUP BY X.TEAM_ID)
ORDER BY 1
;
--25.
SELECT A.SCHE_DATE, (SELECT T.TEAM_NAME
    FROM TEAM T
    WHERE A.HOMETEAM_ID LIKE T.TEAM_ID) || ' - ' ||  (SELECT T.TEAM_NAME
    FROM TEAM T
    WHERE A.AWAYTEAM_ID LIKE T.TEAM_ID
    ) 팀들, CONCAT(A.HOME_SCORE || ' - ',A.AWAY_SCORE) 점수, ABS(A.HOME_SCORE - A.AWAY_SCORE) 점수차
FROM (SELECT C.SCHE_DATE, T.TEAM_NAME, C.HOME_SCORE, C.AWAY_SCORE, C.HOMETEAM_ID, C.AWAYTEAM_ID
    FROM TEAM T JOIN SCHEDULE C
    ON T.STADIUM_ID LIKE C.STADIUM_ID
    WHERE C.SCHE_DATE like '201208%'
    ) A
ORDER BY 1
;
--26.
SELECT DISTINCT STADIUM_ID 스타디움코드, STADIUM_NAME 경기장명
FROM (SELECT 
            STADIUM_ID,
            STADIUM_NAME
        FROM STADIUM)
        JOIN (SELECT STADIUM_ID, SCHE_DATE
            FROM SCHEDULE
            WHERE SCHE_DATE BETWEEN TO_DATE('20120501') AND TO_DATE('20120602')
            )
    USING(STADIUM_ID)
;

SELECT *
FROM (SELECT DISTINCT S.STADIUM_ID 스타디움코드, S.STADIUM_NAME 경기장명
    FROM STADIUM S JOIN SCHEDULE C
        ON S.STADIUM_ID LIKE C.STADIUM_ID
    WHERE C.SCHE_DATE BETWEEN TO_DATE('20120501') AND TO_DATE('20120602')) A
;
--27.
SELECT T.TEAM_NAME 팀명,
    P1.PLAYER_NAME 선수명,
    P1.HEIGHT 키,
    (SELECT ROUND(AVG(P2.HEIGHT),3)
    FROM PLAYER P2
    WHERE P1.TEAM_ID LIKE P2.TEAM_ID
    ) 평균키
FROM PLAYER P1 JOIN TEAM T
    ON P1.TEAM_ID LIKE T.TEAM_ID
ORDER BY 4 DESC, 3
;
--28.
SELECT P.TEAM_ID 팀아이디, T.TEAM_NAME 팀명, ROUND(AVG(P.HEIGHT),2) 평균키
FROM PLAYER P JOIN TEAM T
    ON P.TEAM_ID LIKE T.TEAM_ID
GROUP BY P.TEAM_ID, T.TEAM_NAME
HAVING AVG(P.HEIGHT) < (SELECT AVG(P.HEIGHT)
    FROM PLAYER P JOIN TEAM T
        ON P.TEAM_ID LIKE T.TEAM_ID
    WHERE T.TEAM_NAME LIKE '삼성블루윙즈'
    )
;
--29.
SELECT T.TEAM_NAME 소속팀, P.POSITION 포지션, P.BACK_NO 백넘버, P.PLAYER_NAME 선수명, P.HEIGHT 키
FROM PLAYER P JOIN TEAM T
    ON P.TEAM_ID LIKE T.TEAM_ID
WHERE T.TEAM_NAME IN('드래곤즈', 'FC서울', '일화천마')
AND P.POSITION IN('GK', 'MF')
ORDER BY 1,3
;
--30.
SELECT COUNT(*)
FROM PLAYER P JOIN TEAM T
    ON P.TEAM_ID LIKE T.TEAM_ID
WHERE T.TEAM_NAME NOT IN('드래곤즈', 'FC서울', '일화천마')
AND P.POSITION NOT IN('GK', 'MF')
ORDER BY 1,3
;